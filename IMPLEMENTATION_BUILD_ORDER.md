# 구현 빌드 순서 (작은 기능부터)

## 원칙
- 한 번에 한 기능만 추가한다.
- 각 단계는 "동작 확인 가능" 상태로 끝낸다.
- 실패한 단계는 다음 단계로 넘어가지 않는다.
- 외부 연동(Google Sheet)은 마지막에 붙이기 전에 로컬에서 로직을 먼저 완성한다.
- 시간 저장은 UTC 고정으로 구현한다.

## Step 0. 프로젝트 뼈대
목표:
- Rails 앱 생성, 기본 실행 확인.

완료 기준:
- 홈 화면 1개 렌더링 성공.
- 기본 테스트/린트가 통과.

## Step 1. 입력 파서(순수 Ruby 서비스)
목표:
- 문자열 `업체명 제품명 갯수 [제품명 갯수]...` 파싱.

범위:
- 업체명 1개 + (제품명, 갯수) N쌍 추출.
- 공백 trim 처리.

완료 기준:
- 정상 입력 3종, 오류 입력 3종 단위 테스트 통과.
- 실패 시 표준 에러코드 반환(형식 오류, 숫자 오류).

## Step 2. 유효성 검사기 + 업체명 정규화
목표:
- 파서 결과에 요구사항 검증 규칙과 정규화 규칙 적용.

범위:
- 업체명 앞/뒤 공백 제거.
- 업체명 30자 제한.
- 시트명 금지문자(`[ ] : * ? / \`) 차단.
- 업체명 영문 대문자 통일.
- 갯수 정수만 허용.

완료 기준:
- README 테스트 케이스 T3, T4, T5, T6, T7, T15, T16, T18 대응 테스트 통과.

## Step 3. 중복 제출 방지(멱등성)
목표:
- 동일 요청의 이중 저장 방지.

범위:
- 요청마다 `request_id(UUID)` 수신.
- 서버에서 `request_id` 유니크 보장.
- `request_id` 미전송 요청은 `VALIDATION_ERROR`로 즉시 거부.

완료 기준:
- 동일 `request_id` 재전송 시 중복 저장되지 않음(T20).

## Step 4. 로컬 DB 모델(연동 전 안전판)
목표:
- 외부 API 없이 내부 데이터 모델 확정.

범위:
- `users`, `records`, `record_sheet_indexes` 테이블 생성.
- `records.record_id(UUID)` 인덱스/유니크.
- `record_sheet_indexes`: `record_id -> 시트명/행번호` 매핑.

완료 기준:
- 레코드 생성/수정/삭제 + 인덱스 저장 테스트 통과.

## Step 5. 채팅형 입력 UI(로컬 저장 버전)
목표:
- 입력창에서 메시지 입력 후 결과 표시.

범위:
- 성공 메시지는 하단 누적.
- 형식/숫자 오류 메시지 표시.
- 시간 표시는 UTC 그대로 노출.

완료 기준:
- 브라우저에서 입력-검증-표시 흐름 수동 테스트 통과.

## Step 6. 권한(RBAC) 최소 구현
목표:
- 멤버/관리자 권한 분리.

범위:
- 멤버: 본인 데이터만 조회/수정/삭제.
- 관리자: 전체 데이터 조회/수정/삭제 + 역할 변경.

완료 기준:
- T9, T10 대응 정책 테스트 통과.

## Step 7. Google OAuth 로그인
목표:
- 사용자 로그인 기능 연결.

범위:
- Google OAuth 로그인/로그아웃.
- `INITIAL_ADMIN_EMAIL` 최초 관리자 부여.

완료 기준:
- 제작자 이메일 로그인 시 admin 부여 테스트 통과(T14).

## Step 8. Google Sheets 연결 점검(Service Account)
목표:
- 앱 전용 서비스계정으로 시트 접근 확인.

범위:
- 자격증명 로드.
- `SPREADSHEET_ID` 접근 테스트.
- `TEMPLATE`, `MASTER` 존재 확인.

완료 기준:
- 읽기/쓰기 dry-run 통과(샘플 1행).

## Step 9. 시트 보장 로직
목표:
- 업체 시트 자동 생성 규칙 구현.

범위:
- `[업체명]` 시트 없으면 생성.
- `TEMPLATE` 헤더/서식 복사.
- 이미 있으면 재사용.

완료 기준:
- T8 대응 테스트 통과.

## Step 10. 실제 저장 로직 (MASTER + 업체 시트 동시 반영)
목표:
- 입력 데이터를 시트에 반영.

범위:
- `record_id`, `입력날짜(UTC)`, `담당자`, `업체명`, `제품명`, `갯수` 저장.
- `MASTER` + `[업체명]` 둘 다 append.
- 두 시트 모두 성공해야 성공(원자성).

완료 기준:
- T1, T2, T19, T21 통과.

## Step 11. 수정/삭제 로직(record_id + 인덱스 기반)
목표:
- 시트에서 정확한 행을 찾아 수정/삭제.

범위:
- 1차 조회: 로컬 인덱스 테이블.
- 실패 시 `record_id` 재탐색 + 인덱스 갱신.
- 동시수정은 서버 수신시각 LWW.

완료 기준:
- T11, T12, T22, T23 통과.

## Step 12. 실패 정책/오류코드/팝업
목표:
- "즉시 실패 + 사유 표시" 정책 완성.

범위:
- 1초 내 반영 실패 시 전체 실패.
- 저장하지 않음.
- 팝업: `[데이터 입력 실패]` + 사용자 친화 사유.
- 내부 오류코드 표준화 및 메시지 매핑.

완료 기준:
- T17, T24 통과.
- 원본 예외 전문 미노출 확인.

## Step 13. 반응형/마감 QA
목표:
- 모바일/데스크톱 화면 안정화 후 배포 준비.

범위:
- 반응형 레이아웃 점검.
- SLA 목표(P95 <= 1초) 측정.
- 테스트 케이스 T1~T25 전체 회귀.

완료 기준:
- 기능 테스트 + 수동 QA 체크리스트 완료.

## 병행 권장 트랙
- `dev/stg/prod` 환경 분리 (시트/OAuth 분리)
- Service Account 키 비밀관리/주기 교체
- 성공률/지연시간/오류코드 관측 대시보드
- 모킹 테스트와 실제 Google 연동 테스트 분리

## 세션 재개 시 시작점
다음 세션에서는 `Step 0 -> Step 1`부터 시작한다.
구현 중 변경이 생기면 `readme.md`, `SESSION_CONTEXT_SUMMARY.md`, 본 문서를 같이 갱신한다.
