# 엑셀 저장 방식 전환 메모

작성일: 2026-02-18

## 목적
- 현재 구현은 `Google Sheets 연동`을 목표로 Step 7까지 진행됨.
- 추후 저장 방식을 `엑셀 파일 다운로드 중심`으로 바꿀 수 있으므로, 변경 영향과 트레이드오프를 별도 기록.

## 변경 범위 예측
- Step 0~7 산출물(파서/검증/request_id/RBAC/OAuth/UTC 처리)은 대부분 재사용 가능.
- Step 8~12의 Google Sheets 전용 항목은 대체 대상.
  - Service Account 인증/스프레드시트 접근
  - `MASTER + 업체 시트` 원자성 동기화
  - `record_sheet_indexes`의 시트 행번호 추적
  - Google API 오류코드 맵핑 중심 실패 정책

## 권장 아키텍처(엑셀 전환 시)
- 시스템의 원본 데이터는 DB(`records`)를 단일 소스로 유지.
- 엑셀은 조회 결과를 파일로 생성하여 다운로드 제공.
- 파일 생성 시점에만 `MASTER`와 업체별 시트를 구성.

## 기대 장점
- Google API quota/권한/네트워크 이슈 감소.
- 운영 복잡도(서비스 계정, 외부 동기화 장애 대응) 감소.
- 로컬/테스트 환경 단순화.

## 예상 단점
- 실시간 공동편집/공유 링크 기반 협업 약화.
- 다운로드 시점 스냅샷이므로 최신 동시성 가시성 저하.
- 대용량 데이터에서 파일 생성 시간 증가 가능.

## 유지해야 할 비즈니스 규칙
- `request_id` 필수, 미전송 시 `VALIDATION_ERROR`.
- 시간 저장/표시는 UTC 기준.
- 업체명 정규화 규칙(트림/금지문자/30자/영문 대문자).
- 멤버/관리자 RBAC 정책.

## 전환 시 구현 우선순위 제안
1. 엑셀 exporter 서비스 추가 (`records` -> workbook).
2. 다운로드 엔드포인트 및 권한 제어 추가.
3. 테스트 교체:
   - Google 시트 연동 테스트 -> 엑셀 시트 구조/내용 검증 테스트.
4. 운영 문서/빌드 순서 문서 업데이트.
